{% extends 'layout.html' %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded shadow-sm">
        <h4 class="mb-0 fw-bold">{{ establishment.name }}</h4>
        <a href="{{ url_for('establishment_services', url_prefix=establishment.url_prefix) }}" target="_blank" class="text-decoration-none small fw-bold">
            Ver Página do Cliente <i class="bi bi-box-arrow-up-right"></i>
        </a>
    </div>

    <div class="row">
        <!-- AGENDAMENTOS -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">Agenda do Dia</h5>
                    <table class="table table-hover align-middle">
                        <thead class="table-light"><tr><th>Hora</th><th>Cliente</th><th>Serviço</th><th>Preço</th><th>Ação</th></tr></thead>
                        <tbody>
                            {% for a in appointments %}
                            <tr>
                                <td class="fw-bold">{{ a.appointment_time.strftime('%H:%M') }}</td>
                                <td>{{ a.client_name }} <br> <small class="text-success"><i class="bi bi-whatsapp"></i> {{ a.client_phone }}</small></td>
                                <td>{{ a.service_info.name }}</td>
                                <td class="text-muted">R$ {{ "%.2f"|format(a.service_info.price) }}</td>
                                <td>
                                    <form action="{{ url_for('delete_appointment', id=a.id) }}" method="POST">
                                        <button class="btn btn-sm text-danger"><i class="bi bi-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="5" class="text-center text-muted py-3">Sem agendamentos hoje.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SIDEBAR -->
        <div class="col-lg-4">
            <!-- SERVIÇOS -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <h6 class="fw-bold mb-3">Adicionar Serviço</h6>
                    <form action="{{ url_for('add_service') }}" method="POST">
                        <input type="text" name="name" class="form-control form-control-sm mb-2" placeholder="Nome (ex: Corte)" required>
                        <div class="row g-2 mb-2">
                            <div class="col"><input type="number" name="duration" class="form-control form-control-sm" placeholder="Minutos" required></div>
                            <div class="col"><input type="text" name="price" class="form-control form-control-sm" placeholder="R$ 0.00" required></div>
                        </div>
                        <button class="btn btn-dark btn-sm w-100">Salvar Serviço</button>
                    </form>
                    <hr>
                    <ul class="list-group list-group-flush small">
                        {% for s in services %}
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span>{{ s.name }} (R$ {{ "%.2f"|format(s.price) }})</span>
                            <form action="{{ url_for('delete_service', id=s.id) }}" method="POST"><button class="btn btn-link text-danger p-0"><i class="bi bi-trash"></i></button></form>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- CONFIGURAÇÃO -->
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="fw-bold mb-3">Horários & Dias</h6>
                    <form action="{{ url_for('update_settings') }}" method="POST">
                        <label class="small fw-bold text-muted">SEMANA (SEG-SEX)</label>
                        <div class="row g-2 mb-2">
                            <div class="col"><input type="time" name="work_start" class="form-control form-control-sm" value="{{ establishment.work_start.strftime('%H:%M') }}"></div>
                            <div class="col"><input type="time" name="work_end" class="form-control form-control-sm" value="{{ establishment.work_end.strftime('%H:%M') }}"></div>
                        </div>

                        <label class="small fw-bold text-muted text-primary">FIM DE SEMANA (SÁB-DOM)</label>
                        <div class="row g-2 mb-2">
                            <div class="col"><input type="time" name="weekend_start" class="form-control form-control-sm" value="{{ establishment.weekend_start.strftime('%H:%M') }}"></div>
                            <div class="col"><input type="time" name="weekend_end" class="form-control form-control-sm" value="{{ establishment.weekend_end.strftime('%H:%M') }}"></div>
                        </div>

                        <label class="small fw-bold text-muted">ALMOÇO</label>
                        <div class="row g-2 mb-2">
                            <div class="col"><input type="time" name="lunch_start" class="form-control form-control-sm" value="{{ establishment.lunch_start.strftime('%H:%M') if establishment.lunch_start else '' }}"></div>
                            <div class="col"><input type="time" name="lunch_end" class="form-control form-control-sm" value="{{ establishment.lunch_end.strftime('%H:%M') if establishment.lunch_end else '' }}"></div>
                        </div>

                        <div class="mb-2">
                            <label class="small fw-bold text-muted">DIAS ATIVOS</label><br>
                            {% set days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'] %}
                            {% for i in range(7) %}
                                <div class="form-check form-check-inline m-0">
                                    <input class="form-check-input" type="checkbox" name="work_days" value="{{ i }}" {% if i|string in active_days %}checked{% endif %}>
                                    <label class="form-check-label" style="font-size: 0.75rem;">{{ days[i] }}</label>
                                </div>
                            {% endfor %}
                        </div>

                        <input type="text" name="contact_phone" class="form-control form-control-sm mb-2" value="{{ establishment.contact_phone or '' }}" placeholder="WhatsApp">
                        <button class="btn btn-outline-primary btn-sm w-100">Atualizar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}